<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <ul id="todo-list">
        <!-- To-Do items will be dynamically inserted here -->
    </ul>

    <input type="text" id="new-todo" placeholder="Add new to-do item">
    <button id="add-todo">Add</button>

    <script type='module'>

        import { importData, saveItem, removeItem, updateItem } from './data.js';

        loadData();
        initAddButton();

        function refreshContent() {
            window.location.reload();
        }

        function loadData() {
            const todoList = document.getElementById('todo-list');
            todoList.innerHTML = ''; // Clear existing list items
            const myData = importData();
            for (const key in myData) {
                const todoItem = createTodoItem(key, myData[key]);
                todoList.appendChild(todoItem);
            }
        }

        function initAddButton() {
            const addButton = document.getElementById('add-todo');
            const newTodoInput = document.getElementById('new-todo');
            addButton.addEventListener('click', () => {
                saveItem(newTodoInput.value);

                refreshContent();
            });
        }

        function createTodoItem(key, value) {
            const listItem = document.createElement('li');

            const deleteButton = createDeleteButton(key);
            listItem.appendChild(deleteButton);

            const editButton = createEditButton(key);
            listItem.appendChild(editButton);

            const textLabel = document.createElement('span');
            textLabel.textContent = `${key}: ${value}`;
            listItem.appendChild(textLabel);

            return listItem;
        }

        function createDeleteButton(key) {
            const button = document.createElement('button');
            button.textContent = 'Delete';
            button.addEventListener('click', () => {
                const confirmed = confirm('Are you sure you want to delete this item?');
                if (!confirmed) return;
                removeItem(key);
                refreshContent();
            });
            return button;
        }

        function createEditButton(key) {
            const button = document.createElement('button');
            button.textContent = 'Edit';
            button.addEventListener('click', () => {
                const newValue = prompt('Enter new value:');
                if (newValue !== null) {
                    updateItem(key, newValue);
                    refreshContent();
                }
            });
            return button;
        }
    </script>
</body>

</html>